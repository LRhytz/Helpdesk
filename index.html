<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Help Desk</title>
  <link rel="stylesheet" type="text/css" href="index.css">
  <script src="script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/3.6.2/fetch.min.js"></script>
</head>
<body>

  <!-- Logo -->
  <img src="Images/Oracle.png" alt="My downloaded image" class="top-left">

  <!-- Help Section with Search Bar -->
  <div class="help-section">
    <h2>What can we help you with?</h2>
    <div class="search-container">
      <img src="Icons/search.png" alt="Search Icon" class="search-icon">
      <input type="text" id="search-bar" placeholder="Search..." onkeyup="searchFunction()">
    </div>
  </div>

  <!-- ====================== WORKING INSTRUCTIONS ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-1','arrow-1')">
    <img src="Icons/information-pamphlet.png" class="icon">
    <span>Working Instructions <span id="arrow-1" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-1">
    <ul>
      <!-- Receivables Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-receivables-subtopics','arrow-wi-receivables'); event.stopPropagation();">
          Receivables <span id="arrow-wi-receivables" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-receivables-subtopics">
          <li><a href="pdfs/working_instructions/receivables/How to Approve AR Adjustments .pdf" target="_blank">How to Approve AR Adjustments</a></li>
          <li><a href="pdfs/working_instructions/receivables/How to Create AR Transaction Type and Receipt Activity.pdf" target="_blank">How to Create AR Transaction Type and Receipt Activity</a></li>
          <li><a href="pdfs/working_instructions/receivables/How to Interface AR Invoices.pdf" target="_blank">How to Interface AR Invoices</a></li>
          <li><a href="pdfs/working_instructions/receivables/How to Interface AR Pay Modes.pdf" target="_blank">How to Interface AR Pay Modes</a></li>
          <li><a href="pdfs/working_instructions/receivables/How to Interface Customer.pdf" target="_blank">How to Interface Customer</a></li>
          <li><a href="pdfs/working_instructions/receivables/How to Interface MISC Receipt.pdf" target="_blank">How to Interface MISC Receipt</a></li>
          <li><a href="pdfs/working_instructions/receivables/How to Interface SCD Refund.pdf" target="_blank">How to Interface SCD Refund</a></li>
          <li><a href="pdfs/working_instructions/receivables/How to Interface Standard Receipt.pdf" target="_blank">How to Interface Standard Receipt</a></li>
          <!-- Dynamically list approved Receivables files -->
          <div id="receivables-files"></div>
        </ul>
      </li>

      <!-- Payables Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-payables-subtopics','arrow-wi-payables'); event.stopPropagation();">
          Payables <span id="arrow-wi-payables" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-payables-subtopics">
          <!-- Dynamically load approved files -->
          <div id="payables-files"></div>
        </ul>
      </li>

      <!-- General Ledger Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-gl-subtopics','arrow-wi-gl'); event.stopPropagation();">
          General Ledger <span id="arrow-wi-gl" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-gl-subtopics">
          <!-- Dynamically load approved files -->
          <div id="gl-files"></div>
        </ul>
      </li>

      <!-- Purchasing Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-purchasing-subtopics','arrow-wi-purchasing'); event.stopPropagation();">
          Purchasing <span id="arrow-wi-purchasing" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-purchasing-subtopics">
          <!-- Dynamically load approved files -->
          <div id="purchasing-files"></div>
        </ul>
      </li>

      <!-- Oracle Guides Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-oracle-guides-subtopics','arrow-wi-oracle-guides'); event.stopPropagation();">
          Oracle Guides <span id="arrow-wi-oracle-guides" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-oracle-guides-subtopics">
          <!-- Dynamically load approved files -->
          <div id="oracle-guides-files"></div>
        </ul>
      </li>
    </ul>
  </div>

  <!-- ====================== SOP ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-2','arrow-2')">
    <img src="Icons/standard-operating-procedures.png" class="icon">
    <span>SOP<span id="arrow-2" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-2">
    <ul>
      <!-- Dynamically load SOP files -->
      <div id="sop-files"></div>
    </ul>
  </div>

  <!-- ====================== FUNCTIONAL SPECIFICATIONS ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-4','arrow-4')">
    <img src="Icons/design-resources.png" class="icon">
    <span>Functional Specifications<span id="arrow-4" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-4">
    <ul>
      <!-- Dynamically load Functional Specification files -->
      <div id="functional-specifications-files"></div>
    </ul>
  </div>

  <!-- ====================== PROCESS FLOW ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-3','arrow-3')">
    <img src="Icons/workflow.png" class="icon">
    <span>Process Flow <span id="arrow-3" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-3">
    <ul>
      <!-- Dynamically load Process Flow files -->
      <div id="process-flow-files"></div>
    </ul>
  </div>

  <!-- Add File Section -->
  <div id="addFileContainer" style="display: none;">
    <button type="button" class="button" onclick="toggleAddFileForm()">
      <span class="button__text">Add File</span>
    </button>
    <div id="addFileForm" style="display: none;">
      <input type="file" id="newFileInput">
      <input type="text" id="fileTitle" placeholder="File Title">
      <select id="fileCategory">
        <option value="wi-receivables-subtopics">Receivables</option>
        <option value="wi-payables-subtopics">Payables</option>
        <option value="wi-gl-subtopics">General Ledger</option>
        <option value="wi-purchasing-subtopics">Purchasing</option>
        <option value="wi-oracle-guides-subtopics">Oracle Guides</option>
        <option value="so-sop-subtopics">SOP</option>
        <option value="fs-functional-specifications-subtopics">Functional Specifications</option>
        <option value="pf-process-flow-subtopics">Process Flow</option>
      </select>
      <button class="upload-btn" onclick="uploadFile()">Upload</button>
    </div>
  </div>

  <script>
    function toggleSubTopics(contentId, arrowId) {
      var subtopics = document.getElementById(contentId);
      var arrow = document.getElementById(arrowId);
      subtopics.classList.toggle("show");
      arrow.textContent = subtopics.classList.contains("show") ? "▲" : "▼";
    }

    function uploadFile() {
      var fileInput = document.getElementById('newFileInput');
      var file = fileInput.files[0];
      var fileTitle = document.getElementById('fileTitle').value || (file ? file.name : 'New File');
      var fileCategory = document.getElementById('fileCategory').value;

      if (!file) {
        alert('Please select a file.');
        return;
      }

      var formData = new FormData();
      formData.append('uploadedFile', file);
      formData.append('fileTitle', fileTitle);
      formData.append('fileCategory', fileCategory);

      fetch('https://your-infinityfree-endpoint/upload.php', {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        alert(data);
      })
      .catch(error => console.error('Error:', error));

      fileInput.value = "";
      document.getElementById('fileTitle').value = "";
    }

    function fetchApprovedFiles(subtopic, containerId) {
      fetch('https://your-infinityfree-endpoint/getApprovedFiles.php?subtopic=' + subtopic)
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById(containerId);
          container.innerHTML = ''; // Clear previous content

          data.forEach(file => {
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = file.fileUrl;
            link.target = '_blank';
            link.innerText = file.displayName;
            listItem.appendChild(link);
            container.appendChild(listItem);
          });
        })
        .catch(error => console.error('Error fetching files:', error));
    }

    window.onload = function() {
      fetchApprovedFiles("wi-receivables-subtopics", "receivables-files");
      fetchApprovedFiles("wi-payables-subtopics", "payables-files");
      fetchApprovedFiles("wi-gl-subtopics", "gl-files");
      fetchApprovedFiles("wi-purchasing-subtopics", "purchasing-files");
      fetchApprovedFiles("wi-oracle-guides-subtopics", "oracle-guides-files");
      fetchApprovedFiles("so-sop-subtopics", "sop-files");
      fetchApprovedFiles("fs-functional-specifications-subtopics", "functional-specifications-files");
      fetchApprovedFiles("pf-process-flow-subtopics", "process-flow-files");
    };
  </script>
</body>
</html>
