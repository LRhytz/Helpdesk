<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Help Desk</title>
  <link rel="stylesheet" type="text/css" href="index.css">
  <script src="script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/3.6.2/fetch.min.js"></script>
</head>
<body>

  <!-- Logo -->
  <img src="Images/Oracle.png" alt="My downloaded image" class="top-left">

  <!-- Help Section with Search Bar -->
  <div class="help-section">
    <h2>What can we help you with?</h2>
    <div class="search-container">
      <img src="Icons/search.png" alt="Search Icon" class="search-icon">
      <input type="text" id="search-bar" placeholder="Search..." onkeyup="searchFunction()">
    </div>
  </div>

  <!-- ====================== WORKING INSTRUCTIONS ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-1','arrow-1')">
    <img src="Icons/information-pamphlet.png" class="icon">
    <span>Working Instructions <span id="arrow-1" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-1">
    <ul>
      <!-- Receivables Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-receivables-subtopics','arrow-wi-receivables'); event.stopPropagation();">
          Receivables <span id="arrow-wi-receivables" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-receivables-subtopics">
          <div id="receivables-files"></div>
        </ul>
      </li>

      <!-- Payables Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-payables-subtopics','arrow-wi-payables'); event.stopPropagation();">
          Payables <span id="arrow-wi-payables" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-payables-subtopics">
          <div id="payables-files"></div>
        </ul>
      </li>

      <!-- General Ledger Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-gl-subtopics','arrow-wi-gl'); event.stopPropagation();">
          General Ledger <span id="arrow-wi-gl" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-gl-subtopics">
          <div id="gl-files"></div>
        </ul>
      </li>

      <!-- Purchasing Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-purchasing-subtopics','arrow-wi-purchasing'); event.stopPropagation();">
          Purchasing <span id="arrow-wi-purchasing" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-purchasing-subtopics">
          <div id="purchasing-files"></div>
        </ul>
      </li>

      <!-- Oracle Guides Section -->
      <li>
        <a href="#" onclick="toggleSubTopics('wi-oracle-guides-subtopics','arrow-wi-oracle-guides'); event.stopPropagation();">
          Oracle Guides <span id="arrow-wi-oracle-guides" class="dropdown-arrow">▼</span>
        </a>
        <ul class="nested-subtopics" id="wi-oracle-guides-subtopics">
          <div id="oracle-guides-files"></div>
        </ul>
      </li>
    </ul>
  </div>

  <!-- ====================== SOP ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-2','arrow-2')">
    <img src="Icons/standard-operating-procedures.png" class="icon">
    <span>SOP<span id="arrow-2" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-2">
    <ul>
      <div id="sop-files"></div>
    </ul>
  </div>

  <!-- ====================== FUNCTIONAL SPECIFICATIONS ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-4','arrow-4')">
    <img src="Icons/design-resources.png" class="icon">
    <span>Functional Specifications<span id="arrow-4" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-4">
    <ul>
      <div id="functional-specifications-files"></div>
    </ul>
  </div>

  <!-- ====================== PROCESS FLOW ====================== -->
  <div class="main-title" onclick="toggleSubTopics('subtopics-3','arrow-3')">
    <img src="Icons/workflow.png" class="icon">
    <span>Process Flow <span id="arrow-3" class="dropdown-arrow">▼</span></span>
  </div>
  <div class="subtopics-container" id="subtopics-3">
    <ul>
      <div id="process-flow-files"></div>
    </ul>
  </div>

  <!-- ====================== ADD FILE SECTION ====================== -->
  <div id="addFileContainer" style="display: none;">
    <button type="button" class="button" onclick="toggleAddFileForm()">
      <span class="button__text">Add File</span>
    </button>
    <div id="addFileForm" style="display: none;">
      <input type="file" id="newFileInput">
      <input type="text" id="fileTitle" placeholder="File Title">
      <select id="fileCategory">
        <option value="wi-receivables-subtopics">Receivables</option>
      </select>
      <button class="upload-btn" onclick="uploadFile()">Upload</button>
    </div>
  </div>

  <!-- ====================== ADMIN PASSCODE ====================== -->
  <div id="adminPasscodeSection">
    <div class="group">
      <input class="input" type="password" id="adminPasscode" placeholder="password">
      <button onclick="verifyPasscode()">Enter</button>
    </div>
  </div>

  <script>
    // Function to verify the admin passcode
    function verifyPasscode() {
      var passcodeInput = document.getElementById('adminPasscode');
      var passcode = passcodeInput.value.trim();
      if (passcode === "helpdesk123") {
        document.getElementById('addFileContainer').style.display = 'block';
        document.getElementById('adminPasscodeSection').style.display = 'none';
      } else {
        alert("Incorrect passcode! Please try again.");
      }
    }

    // Fetch approved files for subtopics
    function fetchApprovedFiles(subtopic, containerId) {
      fetch('https://helpdeskpharmacy.infinityfreeapp.com/getApprovedFiles.php?subtopic=' + subtopic)
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById(containerId);
          container.innerHTML = '';
          data.forEach(file => {
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = file.fileUrl;
            link.target = '_blank';
            link.innerText = file.displayName;
            listItem.appendChild(link);
            container.appendChild(listItem);
          });
        })
        .catch(error => console.error('Error fetching files:', error));
    }

    // File upload function
    function uploadFile() {
      const fileInput = document.getElementById('newFileInput');
      const file = fileInput.files[0];
      const fileTitle = document.getElementById('fileTitle').value || (file ? file.name : 'New File');
      const fileCategory = document.getElementById('fileCategory').value;

      if (!file) {
        alert('Please select a file.');
        return;
      }

      const formData = new FormData();
      formData.append('uploadedFile', file);
      formData.append('fileTitle', fileTitle);
      formData.append('fileCategory', fileCategory);

      fetch('https://helpdeskpharmacy.infinityfreeapp.com/upload_file.php', {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        alert(data);
      })
      .catch(error => console.error('Error uploading file:', error));

      fileInput.value = "";
      document.getElementById('fileTitle').value = "";
    }

    window.onload = function() {
      fetchApprovedFiles('wi-receivables-subtopics', 'receivables-files');
      fetchApprovedFiles("wi-payables-subtopics", "payables-files");
      fetchApprovedFiles("wi-gl-subtopics", "gl-files");
      fetchApprovedFiles("wi-purchasing-subtopics", "purchasing-files");
      fetchApprovedFiles("wi-oracle-guides-subtopics", "oracle-guides-files");
      fetchApprovedFiles("so-sop-subtopics", "sop-files");
      fetchApprovedFiles("fs-functional-specifications-subtopics", "functional-specifications-files");
      fetchApprovedFiles("pf-process-flow-subtopics", "process-flow-files");
    };
  </script>
</body>
</html>
